Intro

Flexbench is a fully customizable NodeJS script, generating simulated HTTP traffic.  It can be used as a standalone script to simulate traffic with specific characteristics, such as read/write ratio, duration, number of requests to generate, in/out traffic throttling and more.

Features

Clustering
By utilizing the NodeJS ‘cluster’ module, the script can initialize a cluster of workers, each one simulating a batch of clients, taking full advantage of the hardware resources and parallelization. Each worker has its own process space and heap memory, keeping the batches of clients isolated from each other and using effectively all the cores of the system.
Clients
Each worker is responsible to create a batch of clients. The client will generate HTTP requests. Depending on the configuration, a client can generate requests for a specific duration, or a specific number, with customizable delays between them.  Each client can create requests with a pipelined manner, meaning that the next request is created upon having the previous finished first. The pipelined configuration can also be disabled, having each client generating requests with specific delays, but not waiting for previous ones to finish first.

Delay between requests
Delay is a configured parameter and can be initialized with two ways: As a single value in milliseconds or a range between two values, selecting a random one between of them.

Throttling
Under specific scenarios, there is the need to throttle the generated traffic. This is supported by utilizing the ‘throttle-proxy’ NodeJS module with a few customizations. To throttle or not, is set by a configuration parameter for both inbound and outbound traffic, in bytes per second units.  If enabled, a web proxy server is initialized on start(same number of proxies with workers), handling all the traffic generated both ways, applying a throttle policy on each request.


Duration of test
A test can be configured to run for a specific period or infinitively upon interruption. The configured value is set in seconds.

Number of requests
A test can be configured to run for a specific number of requests generated by all clients. The configured value is an integer value with the total number of requests all the clients should generate.


Statistics
Each worker is capable of collecting its own metrics on served requests.  In this version the total number of responses with their codes is collected.  When the test is finished all workers’ statistics are aggregated by the Master process and values are returned for further processing.

Running Traffic Simulator
Traffic Simulator can be used as a standalone script through command line(TBD) with arguments or to be included in another script. It has 3 main phases: Initialize – Run – Stop. For more details have a look at ‘Code Examples’


